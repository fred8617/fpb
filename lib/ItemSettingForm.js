"use strict";var _row=_interopRequireDefault(require("antd/lib/row"));var _switch=_interopRequireDefault(require("antd/lib/switch"));var _tooltip=_interopRequireDefault(require("antd/lib/tooltip"));var _col=_interopRequireDefault(require("antd/lib/col"));var _card=_interopRequireDefault(require("antd/lib/card"));var _icon=_interopRequireDefault(require("antd/lib/icon"));var _form=_interopRequireDefault(require("antd/lib/form"));var _collapse=_interopRequireDefault(require("antd/lib/collapse"));var _treeSelect=_interopRequireDefault(require("antd/lib/tree-select"));Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("antd/lib/row/style/css");require("antd/lib/switch/style/css");require("antd/lib/tooltip/style/css");require("antd/lib/col/style/css");require("antd/lib/card/style/css");require("antd/lib/icon/style/css");require("antd/lib/button/style/css");var _button=_interopRequireDefault(require("antd/lib/button")),_get2=_interopRequireDefault(require("lodash/get"));require("antd/lib/form/style/css");require("antd/lib/collapse/style/css");require("antd/lib/tree-select/style/css");require("antd/lib/select/style/css");var _select=_interopRequireDefault(require("antd/lib/select")),_react=_interopRequireWildcard(require("react")),_CommonInput=_interopRequireDefault(require("./CommonInput")),_reactBeautifulDnd=require("react-beautiful-dnd"),_useSizeMe3=_interopRequireDefault(require("./useSizeMe")),_mobx=require("mobx"),_FPBForm=_interopRequireDefault(require("./FPBForm")),_GraphqlEditor=_interopRequireDefault(require("./GraphqlEditor"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;return _getRequireWildcardCache=function(){return a},a}function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b=_getRequireWildcardCache();if(b&&b.has(a))return b.get(a);var c={};if(null!=a){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;f&&(f.get||f.set)?Object.defineProperty(c,e,f):c[e]=a[e]}}return c.default=a,b&&b.set(a,c),c}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(b,!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function _arrayWithHoles(a){if(Array.isArray(a))return a}var Size,Option=_select.default.Option,OptGroup=_select.default.OptGroup,TreeNode=_treeSelect.default.TreeNode,Panel=_collapse.default.Panel;(function(a){a[a.SMALL=0]="SMALL",a[a.MIDDLE=1]="MIDDLE",a[a.LARGE=2]="LARGE"})(Size||(Size={}));// xs	<576
// sm	≥576
// md	≥768
// lg	≥992
// xl	≥1200
// xxl ≥1600
var getFormItemCol=function(){// if (width >= 256) {
//   col.labelCol.span = 10;
//   col.wrapperCol.span = 14;
// }
return{labelCol:{span:24},wrapperCol:{span:24}}},getCol=function(a,b){var c={span:24};if(b===Size.LARGE)return c;return b===Size.MIDDLE?576<=a&&1200>a?(c.span=8,c):1200<=a?(c.span=6,c):c:b===Size.SMALL?256<a&&576>a?(c.span=12,c):576<=a&&1200>a?(c.span=6,c):1200<=a?(c.span=4,c):c:void 0},create=_form.default.create,Item=_form.default.Item,ItemSettingForm=function(a){var b=a.form,c=a.item,d=a.onItemPropsChange;console.log("ItemSettingForm",(0,_mobx.toJS)(a,{recurseEverything:!0}));var e=(0,_react.useState)(function(){return a.initialKeyCounter}),f=_slicedToArray(e,2),g=f[0],h=f[1],i=(0,_react.useRef)(c);(0,_react.useEffect)(function(){i.current!==c&&(b.resetFields(),i.current=c)},[c]),(0,_react.useEffect)(function(){//临时解决方案
setTimeout(function(){return Object.keys(g).length&&b.getFieldsValue().componentProps&&b.setFieldsValue({componentProps:b.getFieldsValue().componentProps})},500)},[g]);var j=c||{},k=b.getFieldDecorator,l=b.getFieldsValue,m=b.getFieldValue,n=function(a){return a.children?_react.default.createElement(TreeNode,{value:a.id,title:a.label,key:a.id},a.children.map(function(a){return n(a)})):_react.default.createElement(TreeNode,{value:a.id,title:a.label,key:a.id})},o=k("componentId",{initialValue:j.componentId//preserve: true
}),p=k("autoHeight",{valuePropName:"checked",initialValue:j.autoHeight//preserve: true
}),q=k("isFormField",{valuePropName:"checked",initialValue:j.isFormField//preserve: true
}),r=k("$id",{initialValue:j.$id//preserve: true
}),s=k("label",{initialValue:j.label//preserve: true
}),t=l(),u=t.componentId,v=t.isFormField,w=a.flatComponents[u]||{},x=w.componentProps,y=void 0===x?{}:x,z=w.formField,A=function(a){var c=a.destination,d=a.source;if(c){var e=b.getFieldsValue(),f=(0,_get2.default)(e,c.droppableId),g=f[d.index];f.splice(d.index,1),f.splice(c.index,0,g),b.setFieldsValue({componentProps:e.componentProps})}},B=function(a,c){var d=l(),e=(0,_get2.default)(d,a);e.splice(c,1),g[a].splice(c,1),b.setFieldsValue({componentProps:d.componentProps}),h(_objectSpread({},g))},C=function(b){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"componentProps",e=Object.entries(b);return[].concat(_toConsumableArray(e.filter(function(a){var b=_slicedToArray(a,2),c=b[1];return 0>c.type.indexOf("array")}).map(function(b){var e,f=_slicedToArray(b,2),g=f[0],h=f[1],i="".concat(d,".").concat(g),j={rules:h.rules};return"string"===h.type?e=_react.default.createElement(Item,{label:h.label,key:i},k(i,_objectSpread({initialValue:(0,_get2.default)(c,i)},j))(_react.default.createElement(_CommonInput.default,null))):"FPR"===h.type?e=_react.default.createElement(Item,{label:h.label,key:i},k(i,_objectSpread({initialValue:(0,_mobx.toJS)((0,_get2.default)(c,i),{recurseEverything:!0})},j))(_react.default.createElement(_FPBForm.default,{components:a.components}))):"graphql"===h.type&&(e=_react.default.createElement(Item,{label:h.label,key:i},k(i,_objectSpread({initialValue:(0,_get2.default)(c,i)},j))(_react.default.createElement(_GraphqlEditor.default,null)))),e})),[_react.default.createElement(_collapse.default,{key:"settings",accordion:!0,destroyInactivePanel:!1},e.filter(function(a){var b=_slicedToArray(a,2),c=b[1];return 0<=c.type.indexOf("array")}).map(function(a,e){var f,i,j=_slicedToArray(a,2),l=j[0],m=j[1],n="".concat(d,".").concat(l);return i=g[n]||[],f=_react.default.createElement(Panel,{forceRender:!0,header:m.label,key:"setting".concat(e)},_react.default.createElement(_button.default,{icon:"plus",onClick:function onClick(){var a=(0,_get2.default)(c,d)||{};return a[l]?void(!g[n]&&(g[n]=[]),g[n].push({}),h(_objectSpread({},g))):(g[n]=[{}],void h(_objectSpread({},g)));//这里是有shouldHaveOne的情况，只走这里
}},"\u6DFB\u52A0",m.label),"array:component"===m.type&&_react.default.createElement(_reactBeautifulDnd.DragDropContext,{onDragEnd:A},_react.default.createElement(_reactBeautifulDnd.Droppable,{droppableId:n},function(a){return _react.default.createElement("div",_extends({},a.droppableProps,{ref:a.innerRef}),i.map(function(a,c){var d="".concat(n,"[").concat(c,"]");return _react.default.createElement(_reactBeautifulDnd.Draggable,{key:d,draggableId:d,index:c},function(a){return _react.default.createElement("div",_extends({key:d,ref:a.innerRef},a.draggableProps),_react.default.createElement(_card.default,{style:{margin:"5px 0"},key:"car".concat(c),actions:[_react.default.createElement("div",a.dragHandleProps,_react.default.createElement(_icon.default,{type:"drag",key:"drag"})),_react.default.createElement(_icon.default,{type:"delete",key:"delete",onClick:function onClick(){return B(n,c)}})]},C(b[l].componentProps,"".concat(n,"[").concat(c,"].componentProps"))))})}),a.placeholder)}))||"array:string"===m.type&&_react.default.createElement(_reactBeautifulDnd.DragDropContext,{onDragEnd:A},_react.default.createElement(_reactBeautifulDnd.Droppable,{droppableId:n},function(a){return _react.default.createElement("div",_extends({},a.droppableProps,{ref:a.innerRef}),i.map(function(a,b){var d="".concat(n,"[").concat(b,"]");// console.log(key);
return _react.default.createElement(_reactBeautifulDnd.Draggable,{key:d,draggableId:d,index:b},function(a){return _react.default.createElement("div",_extends({key:d,ref:a.innerRef},a.draggableProps,{className:"ant-form ant-form-inline"}),_react.default.createElement(Item,null,_react.default.createElement("div",a.dragHandleProps,_react.default.createElement(_icon.default,{type:"drag"}))),_react.default.createElement(Item,null,k(d,{//preserve: true,
initialValue:(0,_get2.default)(c,d)})(_react.default.createElement(_CommonInput.default,null))),_react.default.createElement(Item,null,_react.default.createElement(_icon.default,{onClick:function onClick(){return B(n,b)},type:"delete",style:{color:"red",cursor:"pointer"}})))})}),a.placeholder)}))),f}))])},D=C(y),E=(0,_useSizeMe3.default)(function(b){var c=b.width;return _react.default.createElement(_form.default,getFormItemCol(c),_react.default.createElement(_collapse.default,{accordion:!0,defaultActiveKey:["1"],destroyInactivePanel:!1},_react.default.createElement(Panel,{forceRender:!0,header:"\u57FA\u7840\u8BBE\u7F6E",key:"1"},_react.default.createElement(_row.default,{gutter:15},_react.default.createElement(_col.default,getCol(c,Size.MIDDLE),_react.default.createElement(Item,{label:"\u7EC4\u4EF6"},o(_react.default.createElement(_treeSelect.default,{onChange:function onChange(){return h({})},showSearch:!0,style:{width:"100%"},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"\u8BF7\u9009\u62E9\u7EC4\u4EF6",allowClear:!0,autoClearSearchValue:!0,treeDefaultExpandAll:!0},a.componentGroup.map(function(a){return a.id?n(a):_react.default.createElement(TreeNode,{disabled:!0,value:a.groupName,title:a.groupName,key:a.groupName},a[a.groupName].map(function(a){return n(a)}))}))))),_react.default.createElement(_col.default,getCol(c,Size.SMALL),_react.default.createElement(Item,{label:_react.default.createElement("span",null,"\u81EA\u9002\u5E94\u9AD8\u5EA6\xA0",_react.default.createElement(_tooltip.default,{title:"\u5F00\u542F\u540E\u533A\u5757\u5C06\u81EA\u9002\u5E94\u5185\u5BB9\u9AD8\u5EA6\uFF0C\u4E0D\u80FD\u8FDB\u884C\u7EB5\u5411resize\u64CD\u4F5C"},_react.default.createElement(_icon.default,{type:"question-circle-o"})))},p(_react.default.createElement(_switch.default,{checkedChildren:"\u5F00",unCheckedChildren:"\u5173"})))),z&&_react.default.createElement(_react.Fragment,{key:"frag"},_react.default.createElement(_col.default,getCol(c,Size.SMALL),_react.default.createElement(Item,{label:"\u662F\u5426\u4F5C\u4E3A\u8868\u5355\u57DF"},q(_react.default.createElement(_switch.default,{checkedChildren:"\u662F",unCheckedChildren:"\u5426"})))),v&&_react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_col.default,getCol(c,Size.MIDDLE),_react.default.createElement(Item,{label:_react.default.createElement("span",null,"id\xA0",_react.default.createElement(_tooltip.default,{title:"\u8868\u5355\u57DF\u4F20\u503C\u5B57\u6BB5\uFF0C\u4E0D\u586B\u5199\u9ED8\u8BA4\u4E3A\u533A\u5757id\uFF0C\u9700\u4FDD\u8BC1\u552F\u4E00"},_react.default.createElement(_icon.default,{type:"question-circle-o"})))},r(_react.default.createElement(_CommonInput.default,{placeholder:"\u8BF7\u586B\u5199id"})))),_react.default.createElement(_col.default,getCol(c,Size.MIDDLE),_react.default.createElement(Item,{label:_react.default.createElement("span",null,"label")},s(_react.default.createElement(_CommonInput.default,{placeholder:""})))))))),D.length&&_react.default.createElement(Panel,{forceRender:!0,header:"\u81EA\u5B9A\u4E49\u8BBE\u7F6E",key:"2"},D)))},{}),F=_slicedToArray(E,1),G=F[0];return _react.default.createElement(_react.default.Fragment,null,G)},_default=create({onValuesChange:function onValuesChange(a,b,c){var d=Object.keys(b)[0];if(d){var e=b[d];console.log("onValuesChange",d,c[d]),"componentId"===d?a.onItemTypeChange(e):a.onItemPropsChange(d,c[d])}},onFieldsChange:function onFieldsChange(){}})(ItemSettingForm);exports.default=_default;
//# sourceMappingURL=ItemSettingForm.js.map