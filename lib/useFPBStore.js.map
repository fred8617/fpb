{"version":3,"sources":["../src/FPB/useFPBStore.tsx"],"names":["emptyLayouts","xxl","xl","lg","md","sm","xs","Mode","breakpointsStandard","defaultbreakpoints","defaultCols","useFPBStore","props","force","store","source","rowHeight","margin","layouts","breakpoints","cols","draggableCancelClassName","shortid","generate","draggableCancel","editingItem","isPreview","editingTitle","i","config","datas","breakpointsArr","recurseEverything","mode","DESIGN","isDesign","PRIVIEW","changeMode","e","target","value","breakpoint","defaultFormField","breakpointsConfig","Object","keys","computedLayout","fromEntries","map","point","hasLayout","length","setDatas","entries","key","data","Component","componentId","flatComponents","setLayouts","_currentLayout","JSON","stringify","setBreakpoint","_col","setBreakpointFromEntry","setBreakpointConfig","values","setBreakpointSettingVisible","deleteItem","jsConfig","onBreakpointChange","onLayoutChange","onResize","onResizeStop","operatedItem","setOperatedItem","_layout","_oldItem","newItem","findItem","find","b","findItemInAllBreakpoints","items","item","getItemHeight","h","caclHeight","height","itemData","breakpointsItems","autoHeight","forEach","maxH","minH","undefined","Math","ceil","createItem","componentProps","isFormField","$id","setTimeout","doWindowResize","onItemTypeChange","label","component","formField","onItemPropsChange","field","isEditing","setEditingItem","dealChildren","arr","components","parent","id","children","componentGroup","componentsHasGroup","filter","group","componentsNoGroup","allGroup","Set","returnGroup","filterGroup","push","breakpointSettingVisible"],"mappings":"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","sourcesContent":["import React, { ExoticComponent } from 'react';\r\nimport { useLocalStore, useForceUpdate } from 'mobx-react-lite';\r\nimport { doWindowResize } from './utils';\r\nimport { toJS, set, remove } from 'mobx';\r\nimport 'react-grid-layout/css/styles.css';\r\nimport 'react-resizable/css/styles.css';\r\nimport { Size } from 'react-split-pane';\r\nimport shortid from 'shortid';\r\nimport { ItemSettingProps } from './ItemSettingForm';\r\nimport { FormComponentProps, ValidationRule } from 'antd/lib/form';\r\nimport { RadioChangeEvent } from 'antd/lib/radio';\r\nimport { ApolloClient } from 'apollo-boost';\r\n\r\nconst emptyLayouts: BreakpointsLayouts = {\r\n  xxl: [],\r\n  xl: [],\r\n  lg: [],\r\n  md: [],\r\n  sm: [],\r\n  xs: [],\r\n};\r\ninterface Breakpoints {\r\n  xxl?: number;\r\n  xl?: number;\r\n  lg?: number;\r\n  md?: number;\r\n  sm?: number;\r\n  xs?: number;\r\n}\r\ntype ColNumber = 1 | 2 | 3 | 4 | 6 | 8 | 12 | 24;\r\ninterface Cols {\r\n  xxl?: ColNumber;\r\n  xl?: ColNumber;\r\n  lg?: ColNumber;\r\n  md?: ColNumber;\r\n  sm?: ColNumber;\r\n  xs?: ColNumber;\r\n}\r\n/**\r\n * RGL的基础配置\r\n */\r\nexport interface RGLConfig {\r\n  draggableCancel: string;\r\n  /**\r\n   * 元素单位高度\r\n   */\r\n  rowHeight?: number;\r\n  /**\r\n   * 元素间距\r\n   */\r\n  margin?: [number, number];\r\n  /**\r\n   *元素的断点布局\r\n   */\r\n  layouts: BreakpointsLayouts;\r\n  /**\r\n   * 响应断点宽度\r\n   */\r\n  breakpoints: Breakpoints;\r\n  /**\r\n   * 断点对应格子数\r\n   */\r\n  cols: Cols;\r\n}\r\n\r\n/**\r\n * RGL元素\r\n */\r\nexport interface RGLItem {\r\n  /**\r\n   * A string corresponding to the component key\r\n   */\r\n  i: string;\r\n  /**\r\n   * These are all in grid units, not pixels\r\n   */\r\n  x: number;\r\n  y: number;\r\n  w: number;\r\n  h: number;\r\n  minW?: number;\r\n  maxW?: number;\r\n  minH?: number;\r\n  maxH?: number;\r\n  // If true equal to `isDraggable: false, isResizable: false`.\r\n  static?: boolean;\r\n  moved?: boolean;\r\n  // If false, will not be draggable. Overrides `static`.\r\n  isDraggable?: boolean;\r\n  // If false, will not be resizable. Overrides `static`.\r\n  isResizable?: boolean;\r\n}\r\n\r\n/**\r\n * 断点布局\r\n */\r\nexport interface BreakpointsLayouts {\r\n  xxl?: RGLItem[];\r\n  xl?: RGLItem[];\r\n  lg?: RGLItem[];\r\n  md?: RGLItem[];\r\n  sm?: RGLItem[];\r\n  xs?: RGLItem[];\r\n}\r\n\r\n/**\r\n * 组件基础属性\r\n */\r\ninterface BaseComponentProp {\r\n  /**\r\n   * 属性名称\r\n   */\r\n  label: string;\r\n  /**\r\n   * 类型\r\n   */\r\n  type:\r\n    | 'array:component'\r\n    | 'array:string'\r\n    | 'string'\r\n    | 'number'\r\n    | 'FPR'\r\n    | 'graphql';\r\n  /**\r\n   * 校验规则\r\n   */\r\n  rules?: ValidationRule[];\r\n  /**\r\n   * 组件\r\n   */\r\n  Component?: React.ComponentClass | ExoticComponent | null | React.SFC;\r\n  /**\r\n   * type为array时是否默认增加一个元素\r\n   */\r\n  shouldHaveOne?: boolean;\r\n  /**\r\n   * 存在组件的话可设置组件默认属性\r\n   */\r\n  componentProps?: ComponentProps;\r\n}\r\nexport interface CommonComponentProp {\r\n  /**\r\n   * id,用于平铺组件查找,仅仅带有component类型的组件有\r\n   */\r\n  id: string;\r\n}\r\n/**\r\n * 数组组件属性\r\n */\r\nexport interface ArrayComponentProp\r\n  extends BaseComponentProp,\r\n    CommonComponentProp {\r\n  /**\r\n   * 类型\r\n   */\r\n  type: 'array:component';\r\n  /**\r\n   * 组件\r\n   */\r\n  Component: React.ComponentClass | ExoticComponent | React.SFC;\r\n  /**\r\n   * type为array时是否默认增加一个元素\r\n   */\r\n  shouldHaveOne?: boolean;\r\n  /**\r\n   * 存在组件的话可设置组件默认属性\r\n   */\r\n  componentProps?: ComponentProps;\r\n}\r\n/**\r\n * 数组字符串\r\n */\r\nexport interface ArrayStringProp extends BaseComponentProp {\r\n  /**\r\n   * 类型\r\n   */\r\n  type: 'array:string';\r\n  /**\r\n   * type为array时是否默认增加一个元素\r\n   */\r\n  shouldHaveOne?: boolean;\r\n}\r\n\r\nexport interface FPRProp extends BaseComponentProp {\r\n  type: 'FPR';\r\n}\r\n\r\nexport interface StringProp extends BaseComponentProp {\r\n  /**\r\n   * 类型\r\n   */\r\n  type: 'string';\r\n}\r\nexport interface GraphqlProp extends BaseComponentProp {\r\n  /**\r\n   * 类型\r\n   */\r\n  type: 'graphql';\r\n}\r\n\r\nexport interface ComponentProps {\r\n  [propName: string]:\r\n    | FPRProp\r\n    | ArrayComponentProp\r\n    | ArrayStringProp\r\n    | StringProp\r\n    | GraphqlProp;\r\n  children?: FPRProp | ArrayComponentProp | ArrayStringProp | StringProp;\r\n}\r\n\r\n/**\r\n * 组件基础\r\n */\r\nexport interface BaseComponentType {\r\n  /**\r\n   * 主键\r\n   */\r\n  id: string;\r\n  /**\r\n   * 组件名称\r\n   */\r\n  label: string;\r\n  /**\r\n   * 组件引入名称\r\n   */\r\n  name: string;\r\n  asName?: string;\r\n  /**\r\n   * 子组件\r\n   */\r\n  children?: Omit<BaseComponentType, 'children'>[];\r\n  /**\r\n   * 父组件\r\n   */\r\n  parent?: BaseComponentType;\r\n  /**\r\n   * 组件,本想dynamic import 一下，但是webpack不支持\r\n   */\r\n  Component: React.ComponentClass | React.SFC;\r\n  /**\r\n   * 组件属性\r\n   */\r\n  componentProps?: ComponentProps;\r\n  /**\r\n   * 是否可为表单域\r\n   */\r\n  formField?: boolean;\r\n}\r\n\r\n/**\r\n * 组件类型\r\n */\r\nexport interface ComponentType extends BaseComponentType {\r\n  /**\r\n   * 引入路径\r\n   */\r\n  path: string;\r\n  /**\r\n   * 是否为默认引入\r\n   */\r\n  isDefault: boolean;\r\n  /**\r\n   * 分组\r\n   */\r\n  group?: string;\r\n}\r\n\r\nexport interface ComponentGroup {\r\n  [groupName: string]: ComponentType[] | string;\r\n}\r\n\r\nexport interface FPBProps extends FormComponentProps {\r\n  FPR?: boolean;\r\n  forwardRef?: any;\r\n  /**\r\n   * 延迟渲染，在模态框弹出动画非常有用，antd modal设置200即可\r\n   */\r\n  renderDelay?: number;\r\n  defaultDatas?: FPBConfig;\r\n  /**\r\n   * 左侧布局的默认宽度\r\n   */\r\n  contentDefaultSize?: Size;\r\n  /**\r\n   * 导入组件\r\n   */\r\n  components: ComponentType[];\r\n}\r\nexport interface ApolloFPBProps extends FPBProps {\r\n  client: ApolloClient<any>;\r\n}\r\nexport interface BreakpointsConfig {\r\n  breakpoints: string[];\r\n  cols: Cols;\r\n}\r\n\r\nexport interface FPBConfig {\r\n  /**\r\n   *元素的断点布局\r\n   */\r\n  layouts: BreakpointsLayouts;\r\n  /**\r\n   * 数据源\r\n   */\r\n  datas: FPBItemIndexListInitial;\r\n  /**\r\n   * 断点对应格子数\r\n   */\r\n  cols?: Cols;\r\n  /**\r\n   * 包含断点\r\n   */\r\n  breakpoints?: string[];\r\n}\r\n/**\r\n * pb的store\r\n */\r\nexport interface FPBStore extends RGLConfig, ItemSettingProps {\r\n  /**\r\n   * 不让拖拽的样式名称\r\n   */\r\n  draggableCancelClassName: string;\r\n  /**\r\n   * 编辑元素窗口的标题，取i\r\n   */\r\n  editingTitle: string;\r\n  setBreakpointFromEntry(breakpoints: any);\r\n  /**\r\n   * 获取全部配置项以及数据\r\n   */\r\n  config: FPBConfig;\r\n  /**\r\n   * 删除区块\r\n   * @param itemKey 主键\r\n   */\r\n  deleteItem(itemKey: string): void;\r\n  /**\r\n   * 模式\r\n   * @enum Mode\r\n   */\r\n  mode: Mode;\r\n  changeMode: (e: RadioChangeEvent) => void;\r\n  /**\r\n   * 模式\r\n   */\r\n  isPreview: boolean;\r\n  isDesign: boolean;\r\n  /**\r\n   * 索引数据源\r\n   */\r\n  datas: FPBItemIndexList;\r\n  hasLayout: () => boolean;\r\n  breakpoint: 'xxl' | 'xl' | 'lg' | 'md' | 'sm' | 'xs';\r\n  /**\r\n   * 断点数组的key\r\n   */\r\n  breakpointsArr: string[];\r\n  /**\r\n   * 获取当前所有断点的布局数组\r\n   */\r\n  computedLayout: BreakpointsLayouts;\r\n  /**\r\n   *断点计算配置用于表单初始值\r\n   */\r\n  breakpointsConfig: BreakpointsConfig;\r\n  /**\r\n   * 布局变更\r\n   * @param currentLayout 当前布局\r\n   * @param layouts 变更后布局\r\n   */\r\n  setLayouts(currentLayout: BreakpointsLayouts, layouts: BreakpointsLayouts);\r\n  /**\r\n   * 数据集合变更\r\n   *\r\n   * @param datas 数据集合\r\n   */\r\n  setDatas(datas);\r\n  /**\r\n   * 设置当前断点\r\n   * @param breakpoint 当前断点\r\n   * @param col 布局列\r\n   */\r\n  setBreakpoint(breakpoint, col?);\r\n  /**\r\n   * RGLConfig\r\n   */\r\n  jsConfig: RGLConfig;\r\n  /**\r\n   * 根据高度计算元素相对的h\r\n   * @param height 高度\r\n   * @param key 主键\r\n   */\r\n  caclHeight(height: number | null | undefined, key: string);\r\n  /**\r\n   * 创建一个元素\r\n   */\r\n  createItem();\r\n  /**\r\n   * 根据主键查询当前断点下的item\r\n   * @param key 主键\r\n   */\r\n  findItem(key: string): RGLItem;\r\n  /**\r\n   * 找出全部断点下的当前item\r\n   */\r\n  findItemInAllBreakpoints(key: string): { [point: string]: RGLItem };\r\n  /**\r\n   * 获取元素当前响应布局高度高度\r\n   * @param key 主键\r\n   */\r\n  getItemHeight(key): number;\r\n  /**\r\n   * item的resize事件\r\n   */\r\n  onResize: RGLItemCallBack;\r\n  onResizeStop: RGLItemCallBack;\r\n  /**\r\n   * 操作中的item\r\n   */\r\n  operatedItem: RGLItem;\r\n  /**\r\n   * 设置操作中数据\r\n   * @param item @interface RGLItem\r\n   */\r\n  setOperatedItem(item: RGLItem);\r\n  /**\r\n   * 编辑中的数据\r\n   */\r\n  editingItem: FPBItem;\r\n  /**\r\n   * 设置编辑中的数据\r\n   * @param item @interface FPBItem\r\n   */\r\n  setEditingItem(item: FPBItem);\r\n  /**\r\n   * 编辑状态\r\n   */\r\n  isEditing: boolean;\r\n  /**\r\n   * 平铺组件，方便查找\r\n   */\r\n  flatComponents: { [id: string]: ComponentType };\r\n  /**\r\n   * 组件的为formField,则编辑时默认表单域为true\r\n   */\r\n  defaultFormField: boolean;\r\n  /**\r\n   * 断点设置弹出\r\n   */\r\n  breakpointSettingVisible: boolean;\r\n  setBreakpointSettingVisible(breakpointSettingVisible: boolean);\r\n  /**\r\n   * 设置布局断点配置\r\n   */\r\n  setBreakpointConfig(values);\r\n}\r\nexport type RGLItemCallBack = (\r\n  layout: RGLItem[],\r\n  /**\r\n   * 旧数据\r\n   */\r\n  oldItem: RGLItem,\r\n  /**\r\n   * 新数据\r\n   */\r\n  newItem: RGLItem,\r\n  placeholder: RGLItem,\r\n  e: MouseEvent,\r\n  element: HTMLElement,\r\n) => void;\r\nexport interface FPBItemIndexList {\r\n  [key: string]: FPBItem;\r\n}\r\nexport interface FPBItemIndexListInitial {\r\n  [key: string]: Omit<FPBItem, 'Component'>;\r\n}\r\n\r\nexport enum Mode {\r\n  /**\r\n   * 设计模式\r\n   */\r\n  DESIGN = 'design',\r\n  /**\r\n   * 预览模式\r\n   */\r\n  PRIVIEW = 'priview',\r\n}\r\n\r\n/**\r\n * fpb元素\r\n */\r\nexport interface FPBItem {\r\n  /**\r\n   * 主键\r\n   */\r\n  i: string;\r\n  /**\r\n   * 组件类\r\n   */\r\n  Component: React.ComponentClass | React.SFC;\r\n  /**\r\n   * 组件属性\r\n   */\r\n  componentProps: { [key: string]: any };\r\n  /**\r\n   * 自适应高度\r\n   */\r\n  autoHeight: boolean;\r\n  /**\r\n   * 组件id\r\n   */\r\n  componentId: string;\r\n  /**\r\n   * 是否为表单域\r\n   */\r\n  isFormField: boolean;\r\n  /**\r\n   * 表单域id,默认为i\r\n   */\r\n  $id: string;\r\n  /**\r\n   * 表单域的label\r\n   */\r\n  label?: string;\r\n}\r\n// xs\t<576px 响应式栅格，可为栅格数或一个包含其他属性的对象\tnumber|object\t-\r\n// sm\t≥576px 响应式栅格，可为栅格数或一个包含其他属性的对象\tnumber|object\t-\r\n// md\t≥768px 响应式栅格，可为栅格数或一个包含其他属性的对象\tnumber|object\t-\r\n// lg\t≥992px 响应式栅格，可为栅格数或一个包含其他属性的对象\tnumber|object\t-\r\n// xl\t≥1200px 响应式栅格，可为栅格数或一个包含其他属性的对象\tnumber|object\t-\r\n// xxl\r\nexport const breakpointsStandard: Breakpoints = {\r\n  xl: 1600,\r\n  lg: 1200,\r\n  md: 992,\r\n  sm: 768,\r\n  xs: 576,\r\n  // xs: 0\r\n};\r\nconst defaultbreakpoints: Breakpoints = {\r\n  lg: breakpointsStandard.lg,\r\n  // md: breakpointsStandard.md\r\n};\r\nconst defaultCols: Cols = { xxl: 12, xl: 12, lg: 8, md: 6, sm: 4, xs: 2 };\r\n\r\nconst useFPBStore = (props): FPBStore => {\r\n  const force = useForceUpdate();\r\n  const store: FPBStore = useLocalStore<\r\n    FPBStore,\r\n    Omit<Omit<FPBProps, 'form'>, 'apolloClient'>\r\n  >(\r\n    source => ({\r\n      rowHeight: 1,\r\n      margin: [0, 0],\r\n      layouts: emptyLayouts,\r\n      breakpoints: defaultbreakpoints,\r\n      cols: defaultCols,\r\n      get draggableCancelClassName() {\r\n        return shortid.generate();\r\n      },\r\n      get draggableCancel() {\r\n        return store.editingItem !== null || store.isPreview\r\n          ? `.${store.draggableCancelClassName}`\r\n          : '';\r\n      },\r\n      /*********************** */\r\n      get editingTitle() {\r\n        return store.editingItem && store.editingItem.i;\r\n      },\r\n      get config() {\r\n        return toJS<FPBConfig>(\r\n          {\r\n            datas: store.datas,\r\n            layouts: store.layouts,\r\n            cols: store.cols,\r\n            breakpoints: store.breakpointsArr,\r\n          },\r\n          { recurseEverything: true },\r\n        );\r\n      },\r\n      mode: Mode.DESIGN,\r\n      get isDesign() {\r\n        return store.mode === Mode.DESIGN;\r\n      },\r\n      get isPreview() {\r\n        return store.mode === Mode.PRIVIEW;\r\n      },\r\n      changeMode(e) {\r\n        store.mode = e.target.value;\r\n      },\r\n      datas: {},\r\n      breakpoint: 'lg',\r\n      defaultFormField: true,\r\n      get breakpointsConfig() {\r\n        return {\r\n          breakpoints: store.breakpointsArr,\r\n          cols: store.cols,\r\n        };\r\n      },\r\n      get breakpointsArr() {\r\n        return Object.keys(store.breakpoints);\r\n      },\r\n      get computedLayout() {\r\n        return Object.fromEntries(\r\n          store.breakpointsArr.map(point => [\r\n            point,\r\n            store.layouts[point] || [],\r\n          ]),\r\n        );\r\n      },\r\n      hasLayout() {\r\n        return Object.keys(store.datas).length !== 0;\r\n      },\r\n      setDatas(datas: any) {\r\n        const entries = Object.fromEntries(\r\n          Object.entries(datas).map(([key, data]: [string, any]) => [\r\n            key,\r\n            {\r\n              ...data,\r\n              Component:\r\n                data.componentId &&\r\n                store.flatComponents[data.componentId].Component,\r\n            },\r\n          ]),\r\n        ) as any;\r\n        store.datas = entries;\r\n      },\r\n      setLayouts(_currentLayout, layouts) {\r\n        if (JSON.stringify(store.layouts) == JSON.stringify(layouts)) {\r\n          return;\r\n        }\r\n        console.log('layout-change', toJS(store.layouts), layouts);\r\n        store.layouts = layouts;\r\n      },\r\n      setBreakpoint(breakpoint, _col) {\r\n        console.log('setBreakpoint', breakpoint, store.datas);\r\n\r\n        store.breakpoint = breakpoint;\r\n      },\r\n      setBreakpointFromEntry(breakpoints) {\r\n        store.breakpoints = Object.fromEntries(\r\n          breakpoints.map(point => [point, breakpointsStandard[point]]),\r\n        );\r\n      },\r\n      setBreakpointConfig(values) {\r\n        store.setBreakpointFromEntry(values.breakpoints);\r\n        store.cols = {\r\n          ...store.cols,\r\n          ...values.cols,\r\n        };\r\n        store.setBreakpointSettingVisible(false);\r\n      },\r\n      deleteItem(key) {\r\n        remove(store.datas, key);\r\n        force();\r\n      },\r\n      get jsConfig() {\r\n        return toJS(\r\n          {\r\n            layouts: store.computedLayout,\r\n            rowHeight: store.rowHeight,\r\n            margin: store.margin,\r\n            breakpoints: store.breakpoints,\r\n            cols: store.cols,\r\n            onBreakpointChange: store.setBreakpoint,\r\n            onLayoutChange: store.setLayouts,\r\n            onResize: store.onResize,\r\n            onResizeStop: store.onResizeStop,\r\n            draggableCancel: store.draggableCancel,\r\n            //此处是个问题\r\n            // isDraggable: store.editingItem === null && !store.isPreview,\r\n            // isResizable: store.editingItem === null && !store.isPreview,\r\n          },\r\n          { recurseEverything: true },\r\n        );\r\n      },\r\n\r\n      operatedItem: null,\r\n      setOperatedItem(operatedItem) {\r\n        store.operatedItem = operatedItem;\r\n      },\r\n      onResize(_layout, _oldItem, newItem) {\r\n        store.setOperatedItem(newItem);\r\n      },\r\n      onResizeStop() {\r\n        store.setOperatedItem(null);\r\n      },\r\n      findItem(key) {\r\n        return store.layouts[store.breakpoint].find(b => b.i === key);\r\n      },\r\n      findItemInAllBreakpoints(key) {\r\n        return Object.fromEntries(\r\n          Object.entries(store.layouts).map(([point, items]) => [\r\n            point,\r\n            items.find((item: { i: string }) => item.i === key),\r\n          ]),\r\n        );\r\n      },\r\n      getItemHeight(key) {\r\n        const item = store.findItem(key);\r\n        return item && item.h;\r\n      },\r\n      caclHeight(height, key) {\r\n        const itemData = store.datas[key];\r\n        const item = store.findItem(key);\r\n        const breakpointsItems = store.findItemInAllBreakpoints(key);\r\n        if (!itemData.autoHeight) {\r\n          Object.values(breakpointsItems).forEach(item => {\r\n            if (item) {\r\n              delete item.maxH;\r\n              delete item.minH;\r\n            }\r\n          });\r\n\r\n          return;\r\n        }\r\n        if (height === null || height === undefined) {\r\n          return;\r\n        }\r\n        //store中对应的数据，非布局\r\n        const h = Math.ceil(height / store.rowHeight);\r\n        item.h = h || 30;\r\n        item.maxH = item.h;\r\n        item.minH = item.h;\r\n      },\r\n      createItem() {\r\n        const i = shortid.generate();\r\n        // store.layouts[store.breakpoint].push(item);\r\n        const newItem: FPBItem = {\r\n          i,\r\n          Component: null,\r\n          autoHeight: true,\r\n          componentProps: {},\r\n          componentId: null,\r\n          isFormField: null,\r\n          $id: null,\r\n        };\r\n        set(store.datas, i, newItem);\r\n        force();\r\n        setTimeout(doWindowResize, 0);\r\n      },\r\n      editingItem: null,\r\n      onItemTypeChange(value) {\r\n        if (!value) {\r\n          store.editingItem.Component = null;\r\n          store.editingItem.componentProps = null;\r\n          store.editingItem.isFormField = null;\r\n          delete store.editingItem.label;\r\n          return;\r\n        }\r\n        const component = store.flatComponents[value];\r\n\r\n        store.editingItem.Component = component.Component;\r\n        store.editingItem.componentProps = {};\r\n        if (component.formField) {\r\n          store.editingItem.isFormField = store.defaultFormField;\r\n          // store.editingItem.label = \"\";\r\n          set(store.editingItem, 'label', '');\r\n          // .label = '';\r\n          //这里默认给i值吧\r\n          // store.editingItem.$id = shortid.generate()\r\n        }\r\n\r\n        // Object.entries(component.componentProps).\r\n        // store.editingItem.componentProps = ;\r\n        store.editingItem.componentId = value;\r\n\r\n        // set(store.editingItem, field, value);\r\n      },\r\n      onItemPropsChange(field, value) {\r\n        store.editingItem[field] = value;\r\n      },\r\n      get isEditing() {\r\n        return store.editingItem !== null;\r\n      },\r\n      setEditingItem(editingItem) {\r\n        store.editingItem = editingItem;\r\n      },\r\n      get flatComponents() {\r\n        const flatComponents = {};\r\n        const dealChildren = (\r\n          arr: (ComponentType | BaseComponentType)[] = source.components,\r\n          parent?: ComponentType | BaseComponentType,\r\n        ) => {\r\n          arr.forEach(component => {\r\n            flatComponents[component.id] = component;\r\n            if (parent) {\r\n              component.parent = parent;\r\n            }\r\n            if (component.children) {\r\n              dealChildren(component.children, component);\r\n            }\r\n          });\r\n        };\r\n        dealChildren();\r\n        return flatComponents;\r\n      },\r\n      get componentGroup() {\r\n        //有分组组件\r\n        const componentsHasGroup = source.components.filter(\r\n          component => component.group,\r\n        );\r\n        //无分组组件\r\n        const componentsNoGroup = source.components.filter(\r\n          component => !component.group,\r\n        );\r\n        //全部分组\r\n        const allGroup = [\r\n          ...new Set(componentsHasGroup.map(component => component.group)),\r\n        ];\r\n        //自动分组\r\n        const returnGroup = [];\r\n        allGroup.forEach(group => {\r\n          const filterGroup = componentsHasGroup.filter(\r\n            component => component.group === group,\r\n          );\r\n          returnGroup.push({ [group]: filterGroup, groupName: group });\r\n        });\r\n        componentsNoGroup.forEach(component => {\r\n          returnGroup.push(component);\r\n        });\r\n        return returnGroup;\r\n      },\r\n      breakpointSettingVisible: false,\r\n      setBreakpointSettingVisible(breakpointSettingVisible) {\r\n        store.breakpointSettingVisible = breakpointSettingVisible;\r\n      },\r\n    }),\r\n    { components: props.components },\r\n  );\r\n  return store;\r\n};\r\n\r\nexport default useFPBStore;\r\n"],"file":"useFPBStore.js"}