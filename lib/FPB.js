"use strict";var _modal=_interopRequireDefault(require("antd/lib/modal"));var _radio=_interopRequireDefault(require("antd/lib/radio"));var _form=_interopRequireDefault(require("antd/lib/form"));var _button=_interopRequireDefault(require("antd/lib/button"));var _drawer=_interopRequireDefault(require("antd/lib/drawer"));Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("antd/lib/modal/style/css");require("antd/lib/radio/style/css");require("antd/lib/form/style/css");require("antd/lib/button/style/css");require("antd/lib/drawer/style/css");require("antd/lib/empty/style/css");var _empty=_interopRequireDefault(require("antd/lib/empty")),_reactGridLayout=require("react-grid-layout"),_react=_interopRequireWildcard(require("react")),_mobxReactLite=require("mobx-react-lite"),_utils=require("./utils");require("react-grid-layout/css/styles.css"),require("react-resizable/css/styles.css");var _reactSplitPane=_interopRequireDefault(require("react-split-pane")),_ItemSettingForm=_interopRequireDefault(require("./ItemSettingForm")),_ObservableBlock=_interopRequireDefault(require("./ObservableBlock")),_ObservableBlockContainer=_interopRequireDefault(require("./ObservableBlockContainer")),_FormContext=require("./FormContext"),_BreakpointForm=_interopRequireDefault(require("./BreakpointForm")),_useFPBStore=_interopRequireWildcard(require("./useFPBStore")),_mobx=require("mobx");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;return _getRequireWildcardCache=function(){return a},a}function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b=_getRequireWildcardCache();if(b&&b.has(a))return b.get(a);var c={};if(null!=a){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;f&&(f.get||f.set)?Object.defineProperty(c,e,f):c[e]=a[e]}}return c.default=a,b&&b.set(a,c),c}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _extends(){return _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_extends.apply(this,arguments)}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function _arrayWithHoles(a){if(Array.isArray(a))return a}var ResponsiveGridLayout=(0,_reactGridLayout.WidthProvider)(_reactGridLayout.Responsive),FPB=_react.default.memo(function(a){var b=(0,_react.useState)(!1),c=_slicedToArray(b,2),d=c[0],e=c[1],f=(0,_react.useRef)(),g=(0,_useFPBStore.default)(a);a.forwardRef&&(a.forwardRef.current=g),(0,_react.useEffect)(function(){!d&&a.defaultDatas&&(a.FPR&&(g.mode=_useFPBStore.Mode.PRIVIEW),g.setDatas(a.defaultDatas.datas),g.setBreakpointFromEntry(a.defaultDatas.breakpoints),g.setLayouts([],a.defaultDatas.layouts),e(!0),setTimeout(_utils.doWindowResize,a.renderDelay||0))},[a.defaultDatas,a.renderDelay,d]),(0,_react.useEffect)(function(){},[]);var h=a.FPR,i=_react.default.createElement(_FormContext.Provider,{value:{form:a.form}},_react.default.createElement(_mobxReactLite.Observer,null,function(){return _react.default.createElement(ResponsiveGridLayout// useCSSTransforms={false}
,_extends({style:{display:g.hasLayout()?"block":"none"},className:"layout"},g.jsConfig),Object.entries(g.datas).map(function(b){var c=_slicedToArray(b,2),d=c[0],e=c[1];return _react.default.createElement("div",{key:d},_react.default.createElement(_mobxReactLite.Observer,null,function(){return g.mode===_useFPBStore.Mode.DESIGN&&_react.default.createElement(_ObservableBlockContainer.default,{store:g,itemKey:d,data:e})}),_react.default.createElement(_ObservableBlock.default,{store:g,i:d,components:a.components}))}))}));return void 0!==h&&h?i:_react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_mobxReactLite.Observer,null,function(){return _react.default.createElement("style",null,g.isPreview?"\n        .react-grid-item{\n          transition:none!important\n        }\n        .react-grid-layout{\n          transition:none!important\n        }\n        ":null)}),_react.default.createElement(_reactSplitPane.default,{className:"FPB",onDragFinished:_utils.doWindowResize,paneStyle:{position:"relative"},style:{position:"relative"},defaultSize:a.contentDefaultSize||"50%",minSize:479,maxSize:1600},_react.default.createElement("div",{style:{position:"relative"},key:"builder"},_react.default.createElement(_mobxReactLite.Observer,null,function(){return _react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_empty.default,{style:{display:g.hasLayout()?"none":"block"},description:"\u6682\u65E0\u5143\u7D20"}),i)})),_react.default.createElement("div",{key:"setting"},_react.default.createElement(_mobxReactLite.Observer,null,function(){return _react.default.createElement(_drawer.default,{destroyOnClose:!0,title:g.editingItem&&g.editingItem.i,placement:"right",width:"100%",closable:g.isEditing,onClose:function onClose(){return g.setEditingItem(null)},visible:g.isEditing,getContainer:!1,style:{position:"absolute"},bodyStyle:{padding:0,height:"calc( 100% - 54.6px )",overflow:"auto"}},g.isEditing&&_react.default.createElement(_ItemSettingForm.default,{initialKeyCounter:g.editingItem&&(0,_utils.getObjectKeysWhenIsArray)((0,_mobx.toJS)(g.editingItem.componentProps,{recurseEverything:!0})||{},"componentProps")||{},components:a.components,item:g.editingItem,onItemTypeChange:g.onItemTypeChange,onItemPropsChange:g.onItemPropsChange,componentGroup:g.componentGroup,flatComponents:g.flatComponents}))}),_react.default.createElement(_form.default,{layout:"inline"},_react.default.createElement(_form.default.Item,null,_react.default.createElement(_mobxReactLite.Observer,null,function(){return _react.default.createElement(_button.default,{type:"primary",icon:"plus",disabled:g.isPreview,onClick:g.createItem},"\u6DFB\u52A0\u5143\u7D20")})),_react.default.createElement(_form.default.Item,{label:"\u65AD\u70B9"},_react.default.createElement(_mobxReactLite.Observer,null,function(){return _react.default.createElement(_button.default,{disabled:g.isPreview,onClick:function onClick(){return g.setBreakpointSettingVisible(!0)}},"\u65AD\u70B9")})),_react.default.createElement(_form.default.Item,null,_react.default.createElement(_button.default,{onClick:function onClick(){}},"\u83B7\u53D6\u914D\u7F6E")),_react.default.createElement(_form.default.Item,null,_react.default.createElement(_mobxReactLite.Observer,null,function(){return _react.default.createElement(_radio.default.Group,{buttonStyle:"solid",onChange:g.changeMode,value:g.mode},_react.default.createElement(_radio.default.Button,{value:_useFPBStore.Mode.DESIGN},"\u8BBE\u8BA1"),_react.default.createElement(_radio.default.Button,{value:_useFPBStore.Mode.PRIVIEW},"\u9884\u89C8"))}))))),_react.default.createElement(_mobxReactLite.Observer,null,function(){return _react.default.createElement(_modal.default,{centered:!0,destroyOnClose:!0,maskClosable:!1,title:"\u8BBE\u7F6E\u65AD\u70B9",visible:g.breakpointSettingVisible,onOk:function onOk(){return f.current.validateFieldsAndScroll(function(a,b){a||g.setBreakpointConfig(b)})},onCancel:function onCancel(){return g.setBreakpointSettingVisible(!1)}},_react.default.createElement(_BreakpointForm.default,{ref:f,initialData:g.breakpointsConfig}))}))}),FormFPB=_form.default.create({name:"FPB"})(FPB);exports.default=FormFPB;
//# sourceMappingURL=FPB.js.map