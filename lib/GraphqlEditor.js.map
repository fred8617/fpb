{"version":3,"file":"GraphqlEditor.js","names":["create","Item","GraphqlEditor","props","client","useApolloClient","ref","useRef","footerRef","store","useLocalStore","visible","setVisible","setTimeout","minuHeight","current","clientHeight","doWindowResize","useEffect","_","value","getQueryEditor","getValue","onChange","padding","getItem","setItem","param","query","gql"],"sources":["../src/fpb/GraphqlEditor.tsx"],"sourcesContent":["import React, { SFC, useRef, useEffect } from 'react';\nimport GraphiQL from 'graphiql';\nimport 'graphiql/graphiql.css';\nimport { useApolloClient } from '@apollo/react-hooks';\nimport gql from 'graphql-tag';\nimport FullScreenModal from './FullScreenModal';\nimport { printSchema } from 'graphql';\nimport { useLocalStore, Observer } from 'mobx-react-lite';\nimport { Button, Form } from 'antd';\nimport { doWindowResize } from './utils';\nimport ErrorWrapper from './ErrorWrapper';\ninterface GraphqlEditorProps {\n  onChange?(e);\n  value?;\n}\nconst { create, Item } = Form;\nconst GraphqlEditor: SFC<GraphqlEditorProps> = props => {\n  const client = useApolloClient();\n  const ref = useRef();\n  const footerRef: any = useRef();\n  const store = useLocalStore(() => ({\n    visible: false,\n    setVisible(visible) {\n      store.visible = visible;\n      if (visible) {\n        setTimeout(() => {\n          store.minuHeight = footerRef.current.clientHeight + 21;\n          doWindowResize();\n        }, 200);\n      }\n    },\n    minuHeight: 0,\n  }));\n  useEffect(() => {\n    console.log(ref);\n  }, []);\n  return (\n    <>\n      <style>\n        {`\n        \n        .graphiql-container .doc-explorer-title, .graphiql-container .history-title{\n            padding: 0px;\n            height: 34px;\n            line-height: 34px;\n        }\n        `}\n      </style>\n      <Button onClick={_ => store.setVisible(true)}>Graphql编辑器</Button>\n      <Observer>\n        {() => (\n          <FullScreenModal\n            minuHeight={store.minuHeight}\n            closable={false}\n            onOk={() => {}}\n            destroyOnClose\n            footer={\n              <div ref={footerRef}>\n                <Form layout=\"inline\">\n                  <Item>\n                    <Button\n                      type=\"primary\"\n                      onClick={_ => {\n                        const value = (ref.current as any)\n                          .getQueryEditor()\n                          .getValue();\n                        if (props.onChange) {\n                          props.onChange(value);\n                        }\n                      }}\n                    >\n                      保存\n                    </Button>\n                  </Item>\n                  <Item>\n                    <Button\n                      type=\"danger\"\n                      onClick={_ => {\n                        const value = (ref.current as any)\n                          .getQueryEditor()\n                          .getValue();\n                        if (props.onChange) {\n                          props.onChange(value);\n                        }\n                        store.setVisible(false);\n                      }}\n                    >\n                      保存并关闭\n                    </Button>\n                  </Item>\n                  <Item>\n                    <Button\n                      onClick={_ => {\n                        store.setVisible(false);\n                      }}\n                    >\n                      关闭\n                    </Button>\n                  </Item>\n                </Form>\n              </div>\n            }\n            onCancel={_ => store.setVisible(false)}\n            visible={store.visible}\n            bodyStyle={{ padding: 0 }}\n          >\n            {store.visible && (\n              <ErrorWrapper>\n                {() => (\n                  <GraphiQL\n                    query={props.value}\n                    ref={ref}\n                    // response={`{a:1}`}\n                    //   query={null}\n                    storage={{ getItem() {}, setItem() {} }}\n                    operationName={'query'}\n                    fetcher={param => client.query({ query: gql(param.query) })}\n                  >\n                    <GraphiQL.Logo>FPB Graphiql</GraphiQL.Logo>\n                  </GraphiQL>\n                )}\n              </ErrorWrapper>\n            )}\n          </FullScreenModal>\n        )}\n      </Observer>\n    </>\n  );\n};\nexport { GraphqlEditor as default };\n"],"mappings":"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"}